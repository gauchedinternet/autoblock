// ==UserScript==
// @name         social-autoblocker
// @namespace    npm/vite-plugin-monkey
// @version      0.20
// @author       gauchedinternet
// @description  Collect usernames to block and download them as a .txt file.
// @downloadURL  https://raw.githubusercontent.com/gauchedinternet/autoblock/main/script.js
// @updateURL    https://raw.githubusercontent.com/gauchedinternet/autoblock/main/script.js
// @match        *://*.instagram.com/*
// @match        *://*.tiktok.com/*
// @match        *://*.x.com/*
// @match        *://*.bsky.app/*
// @grant        none
// @run-at       document-start
// ==/UserScript==

(function () {
	'use strict';

	var t=Object.defineProperty,e=(e,o,n)=>((e,o,n)=>o in e?t(e,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[o]=n)(e,"symbol"!=typeof o?o+"":o,n);function o(){}function n(t){return t()}function i(){return Object.create(null)}function r(t){t.forEach(n);}function c(t){return "function"==typeof t}function a(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function s(t,e){t.appendChild(e);}function l(t,e,o){t.insertBefore(e,o||null);}function u(t){t.parentNode&&t.parentNode.removeChild(t);}function d(t){return document.createElement(t)}function p(t){return document.createTextNode(t)}function f(){return p(" ")}function h(t,e,o,n){return t.addEventListener(e,o,n),()=>t.removeEventListener(e,o,n)}function g(t,e){e=""+e,t.data!==e&&(t.data=e);}function m(t,e,o,n){null==o?t.style.removeProperty(e):t.style.setProperty(e,o,"");}let b;function k(t){b=t;}function w(t){(function(){if(!b)throw new Error("Function called outside component initialization");return b})().$$.on_mount.push(t);}const x=[],$=[];let y=[];const v=[],S=Promise.resolve();let _=!1;function B(t){y.push(t);}const L=new Set;let E=0;function A(){if(0!==E)return;const t=b;do{try{for(;E<x.length;){const t=x[E];E++,k(t),N(t.$$);}}catch(e){throw x.length=0,E=0,e}for(k(null),x.length=0,E=0;$.length;)$.pop()();for(let t=0;t<y.length;t+=1){const e=y[t];L.has(e)||(L.add(e),e());}y.length=0;}while(x.length);for(;v.length;)v.pop()();_=!1,L.clear(),k(t);}function N(t){if(null!==t.fragment){t.update(),r(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(B);}}const O=new Set;function C(t,e){const o=t.$$;null!==o.fragment&&(!function(t){const e=[],o=[];y.forEach((n=>-1===t.indexOf(n)?e.push(n):o.push(n))),o.forEach((t=>t())),y=e;}(o.after_update),r(o.on_destroy),o.fragment&&o.fragment.d(e),o.on_destroy=o.fragment=null,o.ctx=[]);}function T(t,e){-1===t.$$.dirty[0]&&(x.push(t),_||(_=!0,S.then(A)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31;}function I(t,e,a,s,l,d,p=null,f=[-1]){const h=b;k(t);const g=t.$$={fragment:null,ctx:[],props:d,update:o,not_equal:l,bound:i(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(h?h.$$.context:[])),callbacks:i(),dirty:f,skip_bound:!1,root:e.target||h.$$.root};p&&p(g.root);let m=!1;if(g.ctx=a?a(t,e.props||{},((e,o,...n)=>{const i=n.length?n[0]:o;return g.ctx&&l(g.ctx[e],g.ctx[e]=i)&&(!g.skip_bound&&g.bound[e]&&g.bound[e](i),m&&T(t,e)),o})):[],g.update(),m=!0,r(g.before_update),g.fragment=!!s&&s(g.ctx),e.target){if(e.hydrate){const t=($=e.target,Array.from($.childNodes));g.fragment&&g.fragment.l(t),t.forEach(u);}else g.fragment&&g.fragment.c();e.intro&&((w=t.$$.fragment)&&w.i&&(O.delete(w),w.i(x))),function(t,e,o){const{fragment:i,after_update:a}=t.$$;i&&i.m(e,o),B((()=>{const e=t.$$.on_mount.map(n).filter(c);t.$$.on_destroy?t.$$.on_destroy.push(...e):r(e),t.$$.on_mount=[];})),a.forEach(B);}(t,e.target,e.anchor),A();}var w,x,$;k(h);}class P{constructor(){e(this,"$$"),e(this,"$$set");}$destroy(){C(this,1),this.$destroy=o;}$on(t,e){if(!c(e))return o;const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1);}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1);}}"undefined"!=typeof window&&(window.__svelte||(window.__svelte={v:new Set})).v.add("4");class F{constructor(t,e){this.network=t,this.username=e;}}const U=class t{static init(){let t=localStorage.getItem("autoBlock");null!==t&&(this.data=JSON.parse(t));}static accountLength(){return this.data.account.length}static lookAccount(){return this.data.account[0]}static popAccount(){let t=this.data.account.shift();return this.save(),t}static pushAccount(t){this.data.account.push(t),this.save();}static writeAccount(t){this.data.account=t,this.save();}static switchState(){this.data.state=!this.data.state,this.save();}static resetCounters(){this.data.blocked=0,this.data.notBlocked=0,this.save();}static save(){localStorage.setItem("autoBlock",JSON.stringify(this.data));}static async loadFromInputFile(e){const o=e.target.files[0],n=(await o.text()).split(/\r?\n/).map((t=>{let e=t.split(",");return new F(e[0],e[1])}));this.writeAccount(n),console.log(t.data);}};e(U,"data",new class{constructor(){e(this,"account",[]),e(this,"blocked",0),e(this,"notBlocked",0),e(this,"state",!1),e(this,"hide",!1);}});let j=U,D={"www.instagram.com":{blockListKey:"instagramBlockList",profileUrl:t=>`https://www.instagram.com/${t}`,actionsList:[{info:"Searching for option button",target:'[role="button"]:has([aria-label="Options"])',action:"click",timeout:5e3,sleep:1e3},{info:"Searching for follow button",target:"button:nth-child(1)",action:"store",timeout:5e3,sleep:1e3},{info:"Searching for block button",target:'[role="dialog"] button:nth-child(1)',action:"click",check:(t,e)=>t.innerText!==e.at(-1),timeout:5e3,sleep:1e3},{info:"Searching for block confirmation button",target:'[role="dialog"] button:nth-child(1):nth-last-of-type(2)',action:"click",timeout:5e3,sleep:1e3}]},"www.tiktok.com":{blockListKey:"tiktokBlockList",profileUrl:t=>`https://www.tiktok.com/${t=t.startsWith("@")?t:"@"+t}`,actionsList:[{info:"Searching for option button",target:'[data-e2e="user-more"]',action:"mouseover",timeout:5e3,sleep:1e3},{info:"Searching for follow button",target:'[data-e2e="follow-button"]',action:"store",timeout:5e3,sleep:1e3},{info:"Searching for block button",target:'[data-e2e="user-report"] [role="button"]:nth-last-of-type(1)',action:"click",check:(t,e)=>t.innerText!==e.at(-1),timeout:5e3,sleep:1e3},{info:"Searching for block confirmation button",target:'button[data-e2e="block-popup-block-btn"]',action:"click",timeout:5e3,sleep:1e3}]},"x.com":{blockListKey:"xBlockList",profileUrl:t=>`https://x.com/${t}`,actionsList:[{info:"Searching for follow button",target:'[data-testid="placementTracking"] button',action:"mouseover",timeout:5e3,sleep:1e3},{info:"Storing follow button",target:'[data-testid="placementTracking"]',action:"store",timeout:5e3,sleep:1e3},{info:"Searching for option button",target:'[data-testid="userActions"]',action:"click",timeout:5e3,sleep:1e3},{info:"Searching for block button",target:'[data-testid="block"]',action:"click",check:(t,e)=>!t.innerText.includes(e.at(-1)),timeout:5e3,sleep:1e3},{info:"Searching for block confirmation button",target:'[data-testid="confirmationSheetConfirm"]',action:"click",timeout:5e3,sleep:1e3}]},"bsky.app":{blockListKey:"bskyBlockList",profileUrl:t=>`https://bsky.app/profile/${t}`,actionsList:[{info:"Searching for follow button",target:'[role="button"][data-testid="followBtn"]',action:"store",timeout:5e3,sleep:1e3},{info:"Searching for option button",target:'[role="button"][data-testid="profileHeaderDropdownBtn"]',action:"click",timeout:5e3,sleep:1e3},{info:"Searching for block button",target:'[role="menuitem"][data-testid="profileHeaderDropdownBlockBtn"]',action:"click",check:(t,e)=>t.innerText!==e.at(-1),timeout:5e3,sleep:1e3},{info:"Searching for block confirmation button",target:'[role="button"][data-testid="confirmBtn"]',action:"click",timeout:5e3,sleep:1e3}]}};function K(t){return new Promise((e=>setTimeout(e,t)))}function M(t,e){return new Promise(((o,n)=>{const i=Number(new Date)+e,r=setInterval((()=>{Number(new Date)>i&&(clearInterval(r),n(new Error("Element not found within time: "+t)));const e=document.querySelector(t);e&&(clearInterval(r),o(e));}),100);}))}function z(t,e){console.log(`Simulating ${e} event`);const o=new MouseEvent(e,{view:window,bubbles:!0,cancelable:!0});t.dispatchEvent(o),console.log(`${e} event triggered`);}class H{static async init(){if(j.init(),!j.data.state)return;const t=j.lookAccount();if(!t)return console.log("All the users were blocked!"),j.switchState(),void(window.location.href=window.location.host);let e=t.network,o=D[e].profileUrl(t.username);window.location.href.includes(o)?(await this.performBlockOperation(e)?j.data.blocked++:j.data.notBlocked++,j.accountLength()>0&&j.popAccount(),j.save(),await this.init()):window.location.href=o;}static async startStopResume(){j.resetCounters(),j.switchState(),await this.init();}static async performBlockOperation(t){let e=Array(),o=!0;for(let i of D[t].actionsList){console.info(i.info);try{let t=await M(i.target,i.timeout);if(i.check&&!i.check(t,e))break;"store"===i.action?null===t.textContent?e.push(""):e.push(t.textContent):z(t,i.action),await K(i.sleep);}catch(n){o=!1,console.trace(n);break}}return o}}function R(t){let e,o,n,i,c,a,b,k,w,x,$,y,v,S,_,B,L,E,A,N;return {c(){var r,s,l;e=d("div"),o=d("h3"),o.textContent="Block List Manager",n=f(),i=d("input"),c=f(),a=d("button"),a.textContent="Start / Stop",b=f(),k=d("p"),w=p("Blocked : "),x=p(t[1]),$=f(),y=d("p"),v=p("Not Blocked : "),S=p(t[2]),_=f(),B=d("p"),L=p("Remaining : "),E=p(t[3]),m(o,"text-align","center"),m(o,"margin-bottom","10px"),m(o,"color","rgb(51, 51, 51)"),m(i,"width","100%"),m(i,"margin-top","10px"),s="type",l="file",(r=i).getAttribute(s)!==l&&r.setAttribute(s,l),m(a,"background-color","rgb(254, 44, 85)"),m(a,"color","white"),m(a,"border","none"),m(a,"padding","10px"),m(a,"margin-top","5px"),m(a,"width","100%"),m(a,"border-radius","5px"),m(a,"cursor","pointer"),m(k,"color","black"),m(k,"padding","10px"),m(k,"margin","0px"),m(k,"width","100%"),m(y,"color","black"),m(y,"padding","10px"),m(y,"margin","0px"),m(y,"width","100%"),m(B,"color","black"),m(B,"padding","10px"),m(B,"margin","0px"),m(B,"width","100%"),m(e,"position","fixed"),m(e,"top","100px"),m(e,"display","block"),m(e,"right","20px"),m(e,"width","250px"),m(e,"background-color","rgb(255, 255, 255)"),m(e,"box-shadow","rgba(0, 0, 0, 0.1) 0px 4px 8px"),m(e,"padding","10px"),m(e,"border-radius","8px"),m(e,"z-index","1000000");},m(r,u){l(r,e,u),s(e,o),s(e,n),s(e,i),s(e,c),s(e,a),s(e,b),s(e,k),s(k,w),s(k,x),s(e,$),s(e,y),s(y,v),s(y,S),s(e,_),s(e,B),s(B,L),s(B,E),A||(N=[h(i,"input",t[6]),h(a,"click",t[7])],A=!0);},p(t,e){2&e&&g(x,t[1]),4&e&&g(S,t[2]),8&e&&g(E,t[3]);},d(t){t&&u(e),A=!1,r(N);}}}function q(t){let e,n,i,r,c,a=!t[4]&&R(t);return {c(){e=d("button"),e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"></rect><circle cx="128" cy="128" r="12"></circle><circle cx="128" cy="60" r="12"></circle><circle cx="128" cy="196" r="12"></circle></svg>',n=f(),a&&a.c(),i=p(""),m(e,"width","32px"),m(e,"height","32px"),m(e,"position","absolute"),m(e,"top","60px"),m(e,"right","20px"),m(e,"background-color","#ffffff"),m(e,"box-shadow","0 4px 8px rgba(0,0,0,0.1)"),m(e,"border-radius","8px"),m(e,"z-index","1000000");},m(o,s){l(o,e,s),l(o,n,s),a&&a.m(o,s),l(o,i,s),r||(c=h(e,"click",t[5]),r=!0);},p(t,[e]){t[4]?a&&(a.d(1),a=null):a?a.p(t,e):(a=R(t),a.c(),a.m(i.parentNode,i));},i:o,o:o,d(t){t&&(u(e),u(n),u(i)),a&&a.d(t),r=!1,c();}}}function J(t,e,o){let n=0,i=0,r=0,c=!1;w((()=>{H.init(),o(1,n=j.data.blocked),o(2,i=j.data.notBlocked),o(3,r=j.data.account.length),o(4,c=j.data.hide);}));return [j,n,i,r,c,function(){o(0,j.data.hide=!j.data.hide,j),o(4,c=j.data.hide),j.save();},t=>j.loadFromInputFile(t),()=>H.startStopResume()]}new class extends P{constructor(t){super(),I(this,t,J,q,a,{});}}({target:(()=>{const t=document.createElement("div");return document.body.append(t),t})()});

})();